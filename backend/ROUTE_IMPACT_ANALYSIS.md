# JR西日本路線影響関係マップ

## 概要
このドキュメントは、JR西日本の各路線が他路線に与える影響を分析し、
アプリケーションが正確に遅延情報を取得できるようにするための参考資料です。

## 対象路線（アプリで表示）

| 路線名 | 別名 |
|--------|------|
| 奈良線 | - |
| 京都線 | ＪＲ京都線 |
| 琵琶湖線 | - |
| 湖西線 | - |
| 嵯峨野線 | - |
| 学研都市線 | 片町線 |

## 影響関係マップ

### 1. 奈良線への影響
**影響元路線:**
- 大阪環状線
- 大和路線

**理由:** 大阪環状線・大和路線で発生した事象が奈良線に波及する

---

### 2. 京都線への影響
**影響元路線:**
- ＪＲ神戸線
- 琵琶湖線
- 学研都市線

**理由:** これらの路線は京都線と直接接続し、相互に影響する

---

### 3. 琵琶湖線への影響
**影響元路線:**
- ＪＲ神戸線
- 京都線
- 湖西線

**理由:** 琵琶湖線は京都線・神戸線と一体運用、湖西線と直接接続

---

### 4. 湖西線への影響
**影響元路線:**
- 琵琶湖線
- 京都線

**理由:** 湖西線は琵琶湖線に直接接続

---

### 5. 嵯峨野線への影響
**影響元路線:**
- 京都線

**理由:** 嵯峨野線は京都駅で京都線と接続

---

### 6. 学研都市線への影響
**影響元路線:**
- おおさか東線
- 大阪環状線
- 京都線

**理由:** 学研都市線はこれらの路線と直接接続

---

## チェック対象路線の全リスト

### target_lines（結果に含める路線）
- 奈良線
- 京都線
- 琵琶湖線
- 湖西線
- 嵯峨野線
- 学研都市線

### check_lines_for_impact（影響をチェックするが結果には含めない）
- 大阪環状線
- 大和路線
- ＪＲ神戸線
- おおさか東線
- 阪和線
- 関西線
- ＪＲ東西線
- ＪＲゆめ咲線

**合計チェック対象:** 14路線

---

## 実装詳細

### train_scraper.py の実装

```python
target_lines = {
    "奈良線": ["奈良線"],
    "京都線": ["京都線", "ＪＲ京都線"],
    "琵琶湖線": ["琵琶湖線"],
    "湖西線": ["湖西線"],
    "嵯峨野線": ["嵯峨野線"],
    "学研都市線": ["学研都市線", "片町線"]
}

check_lines_for_impact = {
    "大阪環状線": ["大阪環状線"],
    "大和路線": ["大和路線"],
    "ＪＲ神戸線": ["ＪＲ神戸線", "神戸線"],
    "おおさか東線": ["おおさか東線"],
    "阪和線": ["阪和線"],
    "関西線": ["関西線"],
    "ＪＲ東西線": ["ＪＲ東西線"],
    "ＪＲゆめ咲線": ["ＪＲゆめ咲線"]
}
```

---

## テスト結果

### 全路線統合テスト（2026-01-15 09:23:01）
- ✅ 平常運転: 10路線
- ⚠️  遅延あり: 1路線（奈良線 - 大和路線の影響を正確に検出）
- ❌ 運転見合わせ: 0路線
- 📋 合計: 11路線

### 影響線区検出の動作確認
- ✅ 大和路線の遅延 → 奈良線の遅延として正確に反映
- ✅ 影響線区の解析ロジックが正常に動作
- ✅ 他の路線への誤検出なし

---

## 今後のメンテナンス

### 新規路線追加時のチェックリスト
1. 対象路線を追加する場合は `target_lines` に追加
2. 影響を与える可能性のある路線を `check_lines_for_impact` に追加
3. 影響関係マップを更新
4. 統合テストを実施

### 定期的な確認事項
- JR西日本の路線再編成の確認
- HTML構造の変更確認
- 影響線区の記載方法の変更確認

---

## 関連ファイル
- `backend/train_scraper.py` - スクレイピング実装
- `backend/api_server.py` - API サーバー
- `backend/requirements.txt` - Python依存関係

---

**最終更新:** 2026-01-15  
**作成者:** Train Alert Development Team
